<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ß–µ–∫–ª–∏—Å—Ç –Ω–∞ –Ω–µ–¥–µ–ª—é</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f0f2f5; }
    h1 { text-align: center; }
    .user-select { margin-bottom: 10px; }
    .days { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
    .day-btn { padding: 10px 15px; cursor: pointer; border: none; background: #ddd; border-radius: 5px; }
    .day-btn.active { background: #5e81ac; color: white; }
    .tasks { margin-top: 20px; max-width: 400px; margin-left: auto; margin-right: auto; }
    .task { display: flex; align-items: center; margin-bottom: 10px; }
    .task input[type="checkbox"] { margin-right: 10px; }
  </style>
</head>
<body>

<h1>–ß–µ–∫–ª–∏—Å—Ç –Ω–µ–¥–µ–ª–∏ üóìÔ∏è</h1>

<div class="user-select">
  –Ø ‚Äî 
  <select id="user">
    <option value="user1">–ù–∞—Å—Ç—è</option>
    <option value="user2">–ì—Ä–∏—à–∞</option>
  </select>
</div>

<div class="days" id="day-buttons"></div>

<div class="tasks" id="task-list"></div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
  // ‚¨áÔ∏è –í–°–¢–ê–í–¨ –°–í–û–ò –î–ê–ù–ù–´–ï –ó–î–ï–°–¨
  const firebaseConfig = {
    apiKey: "AIzaSyD_s1qYFW00kgDKalSr_vwEkCxtvgHKMKY",
    authDomain: "check-list-archeage.firebaseapp.com",
    databaseURL: "https://check-list-archeage-default-rtdb.firebaseio.com/",
    projectId: "check-list-archeage",
    storageBucket: "check-list-archeage.firebasestorage.app",
    messagingSenderId: "189792073386",
    appId: "1:189792073386:web:b982dc9463dd00329902d3"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const daysOfWeek = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
  const defaultTasks = ["–ó–∞–¥–∞–Ω–∏–µ 1", "–ó–∞–¥–∞–Ω–∏–µ 2", "–ó–∞–¥–∞–Ω–∏–µ 3"];

  const dayButtonsDiv = document.getElementById('day-buttons');
  const taskListDiv = document.getElementById('task-list');
  const userSelect = document.getElementById('user');

  let selectedDay = '–ü–Ω';

  // —Å–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏
  daysOfWeek.forEach(day => {
    const btn = document.createElement('button');
    btn.textContent = day;
    btn.className = 'day-btn';
    if (day === selectedDay) btn.classList.add('active');
    btn.addEventListener('click', () => {
      selectedDay = day;
      renderDays();
      loadTasks();
    });
    dayButtonsDiv.appendChild(btn);
  });

  function renderDays() {
    const buttons = document.querySelectorAll('.day-btn');
    buttons.forEach(btn => {
      btn.classList.toggle('active', btn.textContent === selectedDay);
    });
  }

  function loadTasks() {
    const user = userSelect.value;
    const ref = db.ref(`checklist/${user}/${selectedDay}`);
    ref.once('value', snapshot => {
      let tasks = snapshot.val();
      if (!tasks) {
        tasks = defaultTasks.map(text => ({ text, done: false }));
        ref.set(tasks);
      }
      renderTasks(tasks);
    });
  }

  function renderTasks(tasks) {
    taskListDiv.innerHTML = '';
    tasks.forEach((task, index) => {
      const div = document.createElement('div');
      div.className = 'task';
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.checked = task.done;
      checkbox.addEventListener('change', () => {
        const user = userSelect.value;
        const ref = db.ref(`checklist/${user}/${selectedDay}/${index}/done`);
        ref.set(checkbox.checked);
      });
      const label = document.createElement('span');
      label.textContent = task.text;
      div.appendChild(checkbox);
      div.appendChild(label);
      taskListDiv.appendChild(div);
    });
  }

  // –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  userSelect.addEventListener('change', loadTasks);

  loadTasks();
</script>

</body>
</html>
